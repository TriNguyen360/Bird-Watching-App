[[extend 'layout.html']]

<style>
[v-cloak] {
     display: none;
}

.dropdown {
  position: relative;
  display: inline-block;
  width: 100%;
}
.dropdown-menu {
  position: absolute;
  background: #fff;
  width: 100%;
  border: 1px solid #ddd;
  z-index: 1000;
}
.dropdown-content {
  max-height: 200px;
  overflow-y: auto;
}
.dropdown-item {
  padding: 8px 12px;
  cursor: pointer;
}
.dropdown-item:hover {
  background: #f0f0f0;
}
</style>


<div class="section" id="app" v-cloak>
  <!-- Navigation Menu -->
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="[[=URL('stats')]]">
          My Stats
        </a>
        <a class="navbar-item" href="[[=URL('checklist')]]">
          Submit a Checklist
        </a>
        <a class="navbar-item" href="[[=URL('location')]]">
          Explore Locations
        </a>
      </div>
    </div>
  </nav>
  
  <!-- Species Selection -->
  <div class="field" style="position: relative; width: 300px;">
    <label class="label">Select Species</label>
    <div class="control" style="position: relative;">
      <input class="input" type="text" placeholder="Search species..."
             v-model="search_query" 
             @focus="show_dropdown = true"
             @blur="hideDropdown"
             style="padding-right: 2em;">
  
      <!-- Clear button (X) -->
      <button v-if="search_query" @click="clearSearch" 
              style="
                position: absolute; 
                right: 0.5em; 
                top: 50%; 
                transform: translateY(-50%); 
                background: none; 
                border: none; 
                cursor: pointer;
                font-size: 1em;">
        Ã—
      </button>
    </div>
    <div class="dropdown" :class="{ 'is-active': show_dropdown && filtered_species.length > 0 }">
      <div class="dropdown-menu" role="menu">
        <div class="dropdown-content">
          <a href="#" 
             class="dropdown-item" 
             v-for="sp in filtered_species" 
             :key="sp.id"
             @mousedown.prevent="selectSpecies(sp.common_name)">
            {{ sp.common_name }}
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Map -->
  <div id="map" style="height: 500px; width: 100%;"></div>

  <!-- Region Buttons (appear when a rectangle is drawn) -->
  <div v-if="region_rectangle" class="buttons" style="margin-top: 1em;">
    <button class="button is-primary" @click="getRegionStats">Statistics on region</button>
    <button class="button is-danger" @click="deleteRegionRectangle">Delete region</button>
  </div>

  <div class="buttons" style="margin-top: 1em; display: flex; justify-content: flex-end;">
    <button 
      class="button" 
      :class="selected_location ? 'is-success' : 'is-light'" 
      :disabled="!selected_location"
      @click="goToChecklist"
      style="margin-right: 10px;">
      Submit a Checklist
    </button>
  </div>
  
  <!-- Put here your Vue.js template -->
  <h1 class="title"><i class="fa-solid fa-cube"></i> Title</h1>
  <p>Content: my_value: {{my_value}} </p>
</div>


[[block page_scripts]]
<!-- Loads the index-specific js for Vue -->
<script>
  let my_callback_url = "[[=XML(my_callback_url)]]";
</script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPrp8MUueIp_C1XRVM4GYStl_JKfSWnr8&loading=async&libraries=visualization,drawing&callback=initMap">
</script>
<script src="js/index.js"></script>
[[end]]
